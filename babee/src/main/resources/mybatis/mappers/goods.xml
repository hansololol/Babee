<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.babee.goods.dao.GoodsDAO">
<!-- 리절트 맵 정의 -->   
   <resultMap id="goodsResult" type="GoodsVO">
      <result property="goods_id" column="goods_id" />
      <result property="goods_title" column="goods_title" />
      <result property="goods_price" column="goods_price" />
      <result property="goods_stock" column="goods_stock" />
      <result property="main_category" column="main_category" />
      <result property="middle_category" column="middle_category" />
      <result property="sub_category" column="sub_category" />
      <result property="seller_id" column="seller_id" />
      <result property="goods_delivery_price" column="goods_delivery_price" />
      <result property="goods_image_name1" column="goods_image_name1" />
      <result property="goods_image_name1_id" column="goods_image_name1_id" />
      <result property="goods_image_name2" column="goods_image_name2" />
      <result property="goods_image_name2_id" column="goods_image_name2_id" />
      <result property="age_range" column="age_range" />
      <result property="goods_creation_date" column="goods_creation_date" />
      <result property="related_tags" column="related_tags" />
      <result property="tag_option1" column="tag_option1" />
      <result property="tag_option2" column="tag_option2" />
      <result property="tag_option3" column="tag_option3" />
      <result property="tag_option4" column="tag_option4" />
      <result property="tag_option5" column="tag_option5" />
   </resultMap>   

   <resultMap id="imageResult" type="ImageFileVO">
      <result property="img_id" column="img_id" />
      <result property="fileName" column="fileName" />
      <result property="reg_id" column="reg_id" />
      <result property="fileType" column="fileType" />
   </resultMap>

   
   <resultMap id="categoryResult" type="CategoryVO">
    <result property="main_Category" column="main_category"/>
    <result property="middle_Category" column="middle_category"/>
    <result property="sub_Category" column="sub_category"/>
</resultMap>

   <resultMap id="goodsQnaResult" type="GoodsQNA">
      <result property="goods_id" column="goods_id" />
      <result property="member_id" column="member_id" />
      <result property="goods_qna_title" column="goods_qna_title" />
      <result property="goods_qna_content" column="goods_qna_content" />
      <result property="goods_qna_writeDate" column="goods_qna_writeDate" />
      <result property="goods_qna_answer" column="goods_qna_answer" />
      <result property="seller_id" column="seller_id" />
   </resultMap>


   <select id="selectAllGoods" resultType="GoodsVO">
    SELECT * FROM t_shopping_goods
  </select>
   <select id="selectAllGoodsQna" resultMap="goodsQnaResult" parameterType="String">
   <![CDATA[
    SELECT * FROM t_shopping_goodsqna where goods_id=#{goods_id}
     ]]>
  </select>
   
    <select id="selectAllCategoryGoods" resultType="goodsVO" parameterType="java.util.Map">
<![CDATA[
   SELECT * FROM t_shopping_goods where main_category=#{main_category} or middle_category=#{middle_category} or sub_category=#{sub_category};
		 ]]>
</select>
   
   <select id="selectGoodsDetail" resultMap="goodsResult"   parameterType="String">
       <![CDATA[
        select * from t_shopping_goods
        where goods_id=#{goods_id};
       ]]>
   </select>
   <select id="selectGoodsDetailImage" resultMap="imageResult" parameterType="String">
       <![CDATA[
             select * from t_shopping_image
             where img_id=#{img_id}
       ]]>
   </select>
   
      <select id="selectGoodsBySearchWord" resultMap="goodsResult" parameterType="String">
     <![CDATA[
          SELECT g.*, d.fileName 
		FROM t_shopping_goods g
		LEFT JOIN t_shopping_image d ON g.goods_image_name1 = d.fileName
		WHERE g.goods_title LIKE CONCAT('%', #{searchWord} ,'%')
		ORDER BY g.goods_creation_date DESC;
      ]]>
   </select>  
    
   
   <select id="selectKeywordSearch" resultType="String" parameterType="String">
       <![CDATA[
        select goods_title from t_shopping_goods 
        where         
        goods_title like concat('%', #{keyword} ,'%')
        order by goods_creDate desc
      ]]>
   </select>

   <insert id="insertGoodsQNA" parameterType="GoodsQNA">
   	   <![CDATA[
   	   	insert into t_shopping_goodsqna 
   	   		(goods_id, member_id, goods_qna_title, 
			goods_qna_content, goods_qna_writeDate)
			values(#{goods_id}, #{member_id}, #{goods_qna_title}, 
			#{goods_qna_content}, now())
   	    ]]>
   </insert>

   
   
    <select id="hotGoodsList" resultType="com.babee.goods.vo.GoodsVO">
	 <![CDATA[
		SELECT b.*, COUNT(a.goods_id) AS order_count
		FROM t_shopping_goods b
		LEFT JOIN t_shopping_order a ON b.goods_id = a.goods_id
		GROUP BY b.goods_id
		ORDER BY order_count DESC
		LIMIT 3;
      ]]>
  	</select>
  	
  	    <select id="seasonGoodsList" resultType="com.babee.goods.vo.GoodsVO">
	 <![CDATA[
		SELECT g.*, d.fileName 
		FROM t_shopping_goods g
		LEFT JOIN t_shopping_image d ON g.goods_image_name1 = d.fileName
		WHERE g.goods_title LIKE CONCAT('%', "명절" ,'%')
		ORDER BY g.goods_creation_date DESC;
      ]]>
  	</select>
   
   <select id="getAllcg" resultType="CategoryVO" >
	    SELECT sub_category
		FROM t_shopping_category
		WHERE main_category = '출산준비' AND middle_category = '임산부 복대';
	</select>
   
</mapper>